<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stars Arena</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #0a0f1e;
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            max-width: 400px;
            width: 100%;
            padding: 20px;
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            background: #1a1f30;
            padding: 15px 20px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .balance {
            color: #ffd700;
            font-weight: bold;
            font-size: 20px;
        }
        .user {
            color: white;
            font-weight: 500;
        }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #1a1f30;
            padding: 5px;
            border-radius: 30px;
        }
        .tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: #8e9ab0;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
        }
        .tab.active {
            background: #4a90e2;
            color: white;
        }

        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* –ë–∞–Ω–∫ */
        .bank {
            background: linear-gradient(135deg, #2a2f45, #1a1f30);
            border-radius: 30px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
            border: 1px solid #3a4055;
        }
        .bank-label {
            color: #8e9ab0;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .bank-value {
            font-size: 48px;
            color: #ffd700;
            font-weight: bold;
        }

        /* –†—É–ª–µ—Ç–∫–∞ */
        .wheel-container {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 20px auto 30px;
        }
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: #2a2f45;
            border: 4px solid #4a90e2;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.3);
            transition: transform 6s cubic-bezier(0.25, 0.1, 0.15, 1);
        }
        .wheel-pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            color: #ffd700;
            z-index: 10;
            filter: drop-shadow(0 0 5px gold);
        }

        /* –ü—Ä–æ—Ü–µ–Ω—Ç—ã */
        .percentages {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 0 10px;
        }
        .percent-item {
            text-align: center;
        }
        .percent-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
        }
        .percent-label {
            font-size: 14px;
            color: #8e9ab0;
            margin-top: 5px;
        }

        /* –ò–Ω—Ñ–æ –æ —Å—Ç–∞–≤–∫–µ */
        .bet-info {
            background: #2a3a55;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
            justify-content: space-around;
            font-size: 16px;
        }

        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .input-group {
            margin: 15px 0;
        }
        .amount-input {
            width: 100%;
            padding: 15px;
            background: #1a1f30;
            border: 2px solid #2a2f45;
            border-radius: 15px;
            color: white;
            font-size: 16px;
            text-align: center;
        }
        .amount-input:focus {
            border-color: #4a90e2;
            outline: none;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn-primary {
            background: #4a90e2;
            color: white;
        }
        .btn-secondary {
            background: #2a2f45;
            color: white;
            border: 1px solid #4a90e2;
        }

        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-card {
            background: #1a1f30;
            padding: 20px;
            border-radius: 20px;
        }
        .profile-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: #0f1425;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }
        .stat-label {
            color: #8e9ab0;
            font-size: 12px;
            margin-bottom: 5px;
        }
        .stat-value {
            color: #ffd700;
            font-size: 20px;
            font-weight: bold;
        }
        .menu-item {
            background: #0f1425;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            text-align: left;
            border: none;
            color: white;
            width: 100%;
            font-size: 16px;
        }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç */
        .result-popup {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .result-content {
            background: #1a1f30;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 300px;
            border: 2px solid #4a90e2;
        }
        .result-title {
            font-size: 24px;
            margin-bottom: 15px;
            color: #ffd700;
        }
        .result-text {
            font-size: 18px;
            margin-bottom: 20px;
            color: white;
        }
        .result-ok {
            background: #4a90e2;
            border: none;
            color: white;
            padding: 10px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <span class="balance" id="balance">0‚≠ê</span>
            <span class="user" id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <button class="tab active" data-tab="pvp">–ò–≥—Ä–∞</button>
            <button class="tab" data-tab="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ò–≥—Ä–∞ -->
        <div id="pvp-tab" class="tab-content active">
            <!-- –†—É–ª–µ—Ç–∫–∞ -->
            <div class="wheel-container">
                <div class="wheel" id="wheel"></div>
                <div class="wheel-pointer">‚ñº</div>
            </div>

            <!-- –ë–∞–Ω–∫ -->
            <div class="bank">
                <div class="bank-label">–ë–ê–ù–ö</div>
                <div class="bank-value" id="bank">0‚≠ê</div>
            </div>

            <!-- –ü—Ä–æ—Ü–µ–Ω—Ç—ã -->
            <div class="percentages">
                <div class="percent-item">
                    <div class="percent-value" id="percent1">0%</div>
                    <div class="percent-label">–ö—Ä–∞—Å–Ω—ã–π</div>
                </div>
                <div class="percent-item">
                    <div class="percent-value" id="percent2">0%</div>
                    <div class="percent-label">–ß–µ—Ä–Ω—ã–π</div>
                </div>
                <div class="percent-item">
                    <div class="percent-value" id="percent3">0%</div>
                    <div class="percent-label">–ó–µ–ª–µ–Ω—ã–π</div>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ –æ —Å—Ç–∞–≤–∫–µ -->
            <div class="bet-info" id="bet-info">
                <span>–°—Ç–∞–≤–∫–∞: <span id="bet-amount">0</span>‚≠ê</span>
                <span>–®–∞–Ω—Å: <span id="bet-percent">0</span>%</span>
                <span>–¶–≤–µ—Ç: <span id="bet-color">‚Äî</span></span>
            </div>

            <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
            <div class="input-group">
                <input type="number" id="bet-input" class="amount-input" placeholder="–í–≤–µ–¥–∏ —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏" min="1" value="10">
            </div>

            <button class="btn btn-primary" id="place-bet">–°–î–ï–õ–ê–¢–¨ –°–¢–ê–í–ö–£</button>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile-tab" class="tab-content">
            <div class="profile-card">
                <div class="profile-actions">
                    <button class="btn btn-primary" id="deposit-btn">üì• –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                    <button class="btn btn-secondary" id="withdraw-btn">üì§ –í—ã–≤–µ—Å—Ç–∏</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
                        <div class="stat-value" id="profile-balance">0‚≠ê</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–ò–≥—Ä</div>
                        <div class="stat-value" id="profile-games">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–ü–æ–±–µ–¥</div>
                        <div class="stat-value" id="profile-wins">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç</div>
                        <div class="stat-value" id="profile-winrate">0%</div>
                    </div>
                </div>

                <button class="menu-item" id="partner-btn">üë• –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</button>
                <button class="menu-item" id="support-btn">üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
                <button class="menu-item" id="promo-btn">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</button>
            </div>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        let mockData = {
            balance: 0,
            bank: 0,
            players: [],
            wins: 0,
            partnerEarned: 0
        };
        let isSpinning = false;

        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            document.getElementById('username').innerText = tg.initDataUnsafe.user.first_name || '–ò–≥—Ä–æ–∫';
        } else {
            document.getElementById('username').innerText = '–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º';
        }

        function updateUI() {
            document.getElementById('balance').innerText = mockData.balance + '‚≠ê';
            document.getElementById('profile-balance').innerText = mockData.balance + '‚≠ê';
            document.getElementById('bank').innerText = mockData.bank + '‚≠ê';
            document.getElementById('profile-games').innerText = mockData.players.length;
            document.getElementById('profile-wins').innerText = mockData.wins;
            const winrate = mockData.players.length > 0 ? ((mockData.wins / mockData.players.length) * 100).toFixed(1) : 0;
            document.getElementById('profile-winrate').innerText = winrate + '%';

            if (mockData.players.length > 0) {
                const total = mockData.players.reduce((sum, p) => sum + p.amount, 0);
                const red = mockData.players.filter(p => p.color.includes('–ö—Ä–∞—Å–Ω—ã–π')).reduce((sum, p) => sum + p.amount, 0);
                const black = mockData.players.filter(p => p.color.includes('–ß–µ—Ä–Ω—ã–π')).reduce((sum, p) => sum + p.amount, 0);
                const green = mockData.players.filter(p => p.color.includes('–ó–µ–ª–µ–Ω—ã–π')).reduce((sum, p) => sum + p.amount, 0);

                document.getElementById('percent1').innerText = ((red/total)*100).toFixed(2) + '%';
                document.getElementById('percent2').innerText = ((black/total)*100).toFixed(2) + '%';
                document.getElementById('percent3').innerText = ((green/total)*100).toFixed(2) + '%';
            } else {
                document.getElementById('percent1').innerText = '0%';
                document.getElementById('percent2').innerText = '0%';
                document.getElementById('percent3').innerText = '0%';
            }
        }

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                const tabName = tab.dataset.tab;
                document.getElementById(tabName + '-tab').classList.add('active');
            });
        });

        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;

            const wheel = document.getElementById('wheel');
            const spins = 8 + Math.floor(Math.random() * 5);
            const totalAngle = spins * 360;

            wheel.style.transition = 'transform 6s cubic-bezier(0.25, 0.1, 0.15, 1)';
            wheel.style.transform = `rotate(${totalAngle}deg)`;

            setTimeout(() => {
                if (mockData.players.length > 0) {
                    const total = mockData.players.reduce((sum, p) => sum + p.amount, 0);
                    const random = Math.random() * total;

                    let cumulative = 0;
                    let winner = null;
                    for (const player of mockData.players) {
                        cumulative += player.amount;
                        if (random <= cumulative) {
                            winner = player;
                            break;
                        }
                    }

                    if (winner) {
                        if (winner.isYou) {
                            mockData.wins++;
                            mockData.balance += mockData.bank;
                            mockData.partnerEarned += mockData.bank * 0.1;
                        }

                        const popup = document.createElement('div');
                        popup.className = 'result-popup';
                        popup.innerHTML = `
                            <div class="result-content">
                                <div class="result-title">üèÜ –ü–û–ë–ï–î–ò–¢–ï–õ–¨</div>
                                <div class="result-text">${winner.color}</div>
                                <div class="result-text">${winner.amount}‚≠ê</div>
                                <button class="result-ok" onclick="this.parentElement.parentElement.remove()">OK</button>
                            </div>
                        `;
                        document.body.appendChild(popup);
                        popup.style.display = 'flex';

                        if (tg.HapticFeedback) {
                            tg.HapticFeedback.notification('success');
                        }
                    }
                }

                isSpinning = false;
                updateUI();
            }, 6000);
        }

        document.getElementById('place-bet').addEventListener('click', () => {
            const amount = parseInt(document.getElementById('bet-input').value);

            if (!amount || amount <= 0) {
                tg.showAlert('‚ùå –í–≤–µ–¥–∏ —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏');
                return;
            }

            if (amount > mockData.balance) {
                tg.showAlert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                return;
            }

            const colors = ['üî¥ –ö—Ä–∞—Å–Ω—ã–π', '‚ö´Ô∏è –ß–µ—Ä–Ω—ã–π', 'üü¢ –ó–µ–ª–µ–Ω—ã–π'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];

            const newPlayer = {
                color: randomColor,
                amount: amount,
                percent: 0,
                isYou: true
            };
            mockData.players.push(newPlayer);
            mockData.bank += amount;
            mockData.balance -= amount;

            mockData.players.forEach(player => {
                player.percent = (player.amount / mockData.bank) * 100;
            });

            document.getElementById('bet-info').style.display = 'flex';
            document.getElementById('bet-amount').innerText = amount;
            document.getElementById('bet-percent').innerText = ((amount / mockData.bank) * 100).toFixed(2);
            document.getElementById('bet-color').innerText = randomColor;

            updateUI();
            spinWheel();
        });

        // ===== –ü–û–ü–û–õ–ù–ï–ù–ò–ï (–†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø) =====
        document.getElementById('deposit-btn').addEventListener('click', () => {
            const amount = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (–æ—Ç 10‚≠ê):');
            if (amount) {
                const numAmount = parseInt(amount);
                if (numAmount >= 10) {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
                    tg.sendData(JSON.stringify({
                        action: 'deposit',
                        amount: numAmount
                    }));
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º Mini App
                    tg.close();
                } else {
                    tg.showAlert('‚ùå –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 10‚≠ê');
                }
            }
        });

        // ===== –í–´–í–û–î =====
        document.getElementById('withdraw-btn').addEventListener('click', () => {
            const amount = prompt('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –≤—ã–≤–æ–¥–∞ (–º–∏–Ω. 100‚≠ê):');
            if (amount) {
                const numAmount = parseInt(amount);
                if (numAmount >= 100) {
                    if (numAmount > mockData.balance) {
                        tg.showAlert('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                        return;
                    }

                    tg.sendData(JSON.stringify({
                        action: 'withdraw',
                        amount: numAmount
                    }));

                    tg.showPopup({
                        title: '‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞',
                        message: `–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ ${numAmount}‚≠ê –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É`,
                        buttons: [{ type: 'ok' }]
                    });

                    mockData.balance -= numAmount;
                    updateUI();

                } else {
                    tg.showAlert('‚ùå –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: 100‚≠ê');
                }
            }
        });

        // ===== –ü–ê–†–¢–ù–Å–†–°–ö–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê =====
        document.getElementById('partner-btn').addEventListener('click', () => {
            const userId = tg.initDataUnsafe.user?.id || 0;
            const refLink = `https://t.me/bot?start=ref_${userId}`;

            tg.showPopup({
                title: 'üë• –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞',
                message: `–¢–≤–æ—è —Å—Å—ã–ª–∫–∞:\n${refLink}\n\n–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: ${mockData.partnerEarned}‚≠ê\n10% –æ—Ç —Å—Ç–∞–≤–æ–∫ –¥—Ä—É–∑–µ–π!`,
                buttons: [
                    { type: 'default', text: 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å' },
                    { type: 'ok', text: 'OK' }
                ]
            }, (btnId) => {
                if (btnId === 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å') {
                    navigator.clipboard.writeText(refLink);
                    tg.showAlert('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
                }
            });
        });

        // ===== –ü–û–î–î–ï–†–ñ–ö–ê =====
        document.getElementById('support-btn').addEventListener('click', () => {
            tg.openTelegramLink('https://t.me/support_bot');
        });

        // ===== –ü–†–û–ú–û–ö–û–î =====
        document.getElementById('promo-btn').addEventListener('click', () => {
            const promo = prompt('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥:');
            if (promo && promo.toLowerCase() === 'arena') {
                mockData.balance += 50;
                updateUI();
                tg.showAlert('‚úÖ –ü–æ–ª—É—á–µ–Ω–æ 50‚≠ê');
            }
        });

        updateUI();
    </script>
</body>
</html>